<?xml version="1.0" encoding="utf-8"?>
<!--
     draft-rfcxml-general-template-annotated-00

     This template includes examples of most of the features of RFCXML with comments explaining
     how to customise them, and examples of how to achieve specific formatting.

     Documentation is at https://authors.ietf.org/en/templates-and-schemas
-->
<?xml-model href="rfc7991bis.rnc"?>  <!-- Required for schema validation and schema-aware editing -->
<!-- <?xml-stylesheet type="text/xsl" href="rfc2629.xslt" ?> -->
<!-- This third-party XSLT can be enabled for direct transformations in XML processors, including most browsers -->

<!DOCTYPE rfc [
  <!ENTITY nbsp    "&#160;">
  <!ENTITY zwsp   "&#8203;">
  <!ENTITY nbhy   "&#8209;">
  <!ENTITY wj     "&#8288;">
]>
<!-- If further character entities are required then they should be added to the DOCTYPE above.
     Use of an external entity file is not recommended. -->

<rfc
  xmlns:xi="http://www.w3.org/2001/XInclude"
  category="info"
  docName="draft-augustyn-intarea-ipref-framework-00"
  ipr="trust200902"
  obsoletes=""
  updates=""
  submissionType="IETF"
  xml:lang="en"
  version="3">
<!--
    * docName should be the name of your draft
    * category should be one of std, bcp, info, exp, historic
    * ipr should be one of trust200902, noModificationTrust200902, noDerivativesTrust200902, pre5378Trust200902
    * updates can be an RFC number as NNNN
    * obsoletes can be an RFC number as NNNN
-->

  <front>
    <title abbrev="IPREF Framework">Framework for IP Addressing with References (IPREF)</title> <!-- https://authors.ietf.org/en/rfcxml-vocabulary#title-4 -->
    <!--  The abbreviated title is required if the full title is longer than 39 characters -->

    <seriesInfo name="Internet-Draft" value="draft-augustyn-intarea-ipref-framework-00"/> <!-- https://authors.ietf.org/en/rfcxml-vocabulary#seriesinfo -->
    <!-- Set value to the name of the draft  -->

    <author fullname="Waldemar Augustyn" initials="W" role="editor" surname="Augustyn"> <!-- https://authors.ietf.org/en/rfcxml-vocabulary#author -->
    <!-- initials should not include an initial for the surname -->
    <!-- role="editor" is optional -->
    <!-- Can have more than one author -->

    <!-- all of the following elements are optional -->
      <address> <!-- https://authors.ietf.org/en/rfcxml-vocabulary#address -->
        <email>waldemar@wdmsys.com</email>
      </address>
    </author>

    <date year="2022" month="11" day="28"/> <!-- https://authors.ietf.org/en/rfcxml-vocabulary#date -->
    <!-- On draft subbmission:
         * If only the current year is specified, the current day and month will be used.
         * If the month and year are both specified and are the current ones, the current day will
           be used
         * If the year is not the current one, it is necessary to specify at least a month and day="1" will be used.
    -->

    <area>General</area>
    <workgroup>Internet Engineering Task Force</workgroup>
    <!-- "Internet Engineering Task Force" is fine for individual submissions.  If this element is
          not present, the default is "Network Working Group", which is used by the RFC Editor as
          a nod to the history of the RFC Series. -->

    <keyword>IPREF</keyword>
    <!-- Multiple keywords are allowed.  Keywords are incorporated into HTML output files for
         use by search engines. -->

    <abstract>
      <t>This document describes IP addressing with references (IPREF) and how it can be used with IPv4 and IPv6.</t>
      <t>It also described how IPREF addresses may be distributed through Domain Name System</t>
    </abstract>

  </front>

  <middle>

    <section>
    <!-- The default attributes for <section> are numbered="true" and toc="default" -->
      <name>Introduction</name>
      <t>Introductory text</t>

      <section anchor="requirements">
      <!-- anchor is an optional attribute -->
        <name>Requirements Language</name>
        <t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL",
          "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT
          RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be
          interpreted as described in BCP 14 <xref target="RFC2119"/>
          <xref target="RFC8174"/> when, and only when, they appear in
          all capitals, as shown here.</t>
      </section>
      <!-- The 'Requirements Language' section is optional -->

      <section anchor="terminology"><name>IPREF Terminology</name>
        <t>IPREF - short name referring to the technology described in this document, pronounced I-P-REF</t>
        <t><em>ea</em> - encoded address, a native address presented to hosts in lieu of an IPREF address </t>
        <t><em>our</em> - pertaining to IP address, IPREF address, or reference controlled by the local network</t>
        <t><em>ref</em> - IPREF reference</t>
        <t><em>their</em> - pertaining to IP address, IPREF address, or reference controlled by the remote network</t>
        <t><em>third</em> network - network connecting communicating private networks, e.g.: the Internet</t>
        <t><em>encoding</em> network - network representing hosts on peer private network</t>
      </section>

    </section>

    <section><name>Overview</name>

      <t>IP addressing with references (IPREF) is intended for communication between private networks connected
        via a <em>third</em> network, typically the Internet. The references are opaque integers that factor
        in calculating of actual addresses at the respective private networks. References are not direct IP addresses.
        Each private network makes their calculations independently irrespective of how their peers might be interpreting
        the very same references. The resulting addresses are normally different (they may be the same by chance) and
        are not known to the peers.
      </t>
      <t>IPREF deals exclusively with private networks, there is no provision to communicate directly with 'public' hosts,
        i.e. hosts with addresses on the <em>third</em> network. There is no need to. The 'public' hosts normally reside
        on private networks anyway but are made avalable on the 'public' network using traditional NAT (Network Address
        Translation). Since they reside on private networks, they can be reached through IPREF direclty without NAT. IPREF
        is a form of network address translation but it is never referred to it by this term to avoid confusion with well
        known NAT. It is always referred to as IPREF. It is an evolution of network address translation.
      </t>

      <section><name>IPREF Addresses</name>

        <t>The references are used in conjunction with standard IP addresses from the third network. These are typically
          addresses of gateway interfaces where the packets arrive at or where they are being sent to. A combination of
          a <em>third</em> network IP address and the reference is called an IPREF address, <xref target="ipref-address"/>.
        </t>

        <figure anchor="ipref-address"><name>IPREF address</name>
          <artset> <artwork type="ascii-art" name="ipref address diagram"> <![CDATA[
         ┌───────────────────┬───────────────────┐
         │    IP address     │    reference      │
         └───────────────────┴───────────────────┘
            198.51.100.11+700
            2001:db8::abc:11+700
              ]]> </artwork> </artset>
        </figure>

        <t>In the notation, a plus sign '+' is used to separate the IP address from the reference. In a packet exchange,
          there is a source IPREF address and a destination IPREF address, thus two references. The destination reference
          is allocated by the destination private network while the source reference is allocated by the source private
          network. There are no negotiations. Each peer defines their own references and accept peer references as opaque
          values.
        </t>

      </section>  <!-- ^^ IPREF Addresses ^^ -->

      <section><name>Packet Exchange</name>

        <t><xref target="private-networks"/> depicts how two local networks communicate with one another. Local
            network A has two standard hosts A5, A7, and a gateway GWA. The gateway connects to the <em>third</em> network,
            the Internet. Local network B has hosts B4, B6, and a gateway GWB. The gateway connects to the same <em>third</em>
            network as gateway GWA. Only the gateways are aware of, and implement, IPREF processing. The hosts on both local
            networks, as well as any networks hosts, routers, or nodes on the <em>third</em> network are standard network devices,
            unaware of IPREF. For simplicity, the examples shows the case of IPv4 running on all three networks. The IP addresses
            on local networks may overlap but for simplicity are shown as distinct. Further, for ease of following the example,
            addresses related to local network A are odd while addresses related to local network B are even.
        </t>
        <t>Hosts on local network A communicate with hosts on other local networks, such as local network B, without knowing
          the IP addresses on the peer network or even without knowing the network protocol employed by the peer network. An
          <em>encoding</em> network is used in lieu of the peer private network addresses. The peer hosts appear as if they were
          hosted on the <em>encoding</em> network. This is a compatibility feature. It is possible to avoid such mapping at the cost
          of making local hosts IPREF aware. That case is not described here as it is dramatically simpler to use <em>encoding</em>
          networks and leave existing hosts as-is without any modifications.
        </t>

        <figure anchor="private-networks"><name>private networks</name>
          <artset>  <!-- https://authors.ietf.org/en/rfcxml-vocabulary#artset -->
            <artwork type="ascii-art" name="private networks diagram">
              <![CDATA[
                  ╲                   ╲     Encoding Network B: 10.192.0.0/10
                                               Local Network B: 172.18.2.0/24
                    ╲                   ╲
                                                                   ┌──────┐
                      ╲                   ╲                   ┃ .66│      │
                                         ┏━━━━━━━┓            ┠────┤ host │
                        ╲  198.51.100.22 ┃ IPREF ┃.2          ┃    │  B6  │
                                       ╭─┨ g-way ┠────────────┨    └──────┘
    ┌──────┐              ╲            ╎ ┃  GWB  ┃            ┃
    │      │.75 ┃                      ╎ ┗━━━━━━━┛            ┃
    │ host ├────┨           ╲                   ╲             ┃    ┌──────┐
    │  A5  │    ┃                Third Network                ┃ .64│      │
    └──────┘    ┃             ╲                   ╲           ┠────┤ host │
                ┃            ┏━━━━━━━┓ ╎                      ┃    │  B4  │
                ┃         .1 ┃ IPREF ┃ ╎            ╲              └──────┘
    ┌──────┐    ┠────────────┨ g-way ┠─╯
    │      │.77 ┃            ┃  GWA  ┃ 198.51.100.11  ╲
    │ host ├────┨            ┗━━━━━━━┛
    │  A7  │    ┃                   ╲                   ╲
    └──────┘
                                      ╲                   ╲
     Local Network A: 172.17.1.0/24
  Encoding Network A: 10.128.0.0/10     ╲                   ╲
              ]]>
            </artwork>
          </artset>
        </figure>

        <t>Let's assume host A5 wants to send a packet to host B4 and receive a response. Prior to the packet
          exchange, an administrator from local network B informs an administrator of local network A that host
          B can be reached at an IPREF address 198.151.100.22+400. Local administrator enters that information
          on gateway GWA which in turn allocates an <em>encoded</em> address of 10.128.0.40 to represent host B.
          This information is further passed to host A5 so that it can send packets to host B by using 10.128.0.40
          as the destination.
        </t>
        <t>In step (1) host A5 places its own address as source, 172.17.1.75 and the provided address of host B 10.128.0.40
          as destination. As the packet traverses the network, both source and destination addresses will be rewritten.
          It is illustrated in <xref target="address-rewriting"/>. In step (2), the packet arrives at gateway GWA. The gateway
          realizes the destination is an <em>encoded</em> address. It finds that the address corresponds to an IPREF address
          198.51.100.22+400. It places this IPREF address in the packet as the new destination address. It also finds that
          the source address 172.17.1.75 does not correspond to any IPREF address so it allocates one, through some algorithm
          perhaps randomly, as 198.51.100.11+50. It places this IPREF address in the packet as the new source address. It then
          sends the packet into the <em>third</em> network. This is the common network, the Internet, that both local networks
          A and B connect to. In step (3) the packet arrives at gateway GWB. The gateway recognizes the destination IPREF address
          as representation of the internal host's B address 172.18.2.64. It places this address in the packet as new destination
          address. The gateway does not recognize the source IPREF address so it allocates an <em>encoded</em> address for it
          10.192.0.70. It places this address in the packet as the new source address. It, then, sends the packet to the local
          host B4. In step (4), local host B4 receives the packet and recognizes the destination address as its own. It consumes
          the packet and processes it according to the payload.
        </t>

        <figure anchor="address-rewriting"><name>address rewriting</name>
          <artset> <artwork type="ascii-art" name="address rewriting diagram"> <![CDATA[
  Host B4 has IPREF address: 198.51.100.22+400
          encoded at GWA as: 10.128.0.40

  Host A5 is allocated IPREF address: 198.51.100.11+50
                   encoded at GWB as: 10.192.0.70

  Sending a packet from A5 to B4 and receiving a response back at A5:

         ┌───────────────────┬───────────────────┬─────────┐
  1 A5:  │    172.17.1.75    │    10.128.0.40    │ payload │
         └───────────────────┴───────────────────┴─────────┘
         ┌───────────────────┬───────────────────┬─────────┐
  2 GWA: │ 198.51.100.11+50  │ 198.51.100.22+400 │ payload │
         └───────────────────┴───────────────────┴─────────┘
                          ┌───────────────────┬───────────────────┬─────────┐
  3                  GWB: │    10.192.0.70    │    172.18.2.64    │ payload │
                          └───────────────────┴───────────────────┴─────────┘
                          ┌───────────────────┬───────────────────┬─────────┐
  4                  B4:  │    10.192.0.70    │    172.18.2.64    │ payload │
                          └───────────────────┴───────────────────┴─────────┘

                          ┌───────────────────┬───────────────────┬─────────┐
  5                  B4:  │    172.18.2.64    │    10.192.0.70    │ payload │
                          └───────────────────┴───────────────────┴─────────┘
                          ┌───────────────────┬───────────────────┬─────────┐
  6                  GWB: │ 198.51.100.22+400 │ 198.51.100.11+50  │ payload │
                          └───────────────────┴───────────────────┴─────────┘
         ┌───────────────────┬───────────────────┬─────────┐
  7 GWA: │    10.128.0.40    │    172.17.1.75    │ payload │
         └───────────────────┴───────────────────┴─────────┘
         ┌───────────────────┬───────────────────┬─────────┐
  8 A5:  │    10.128.0.40    │    172.17.1.75    │ payload │
         └───────────────────┴───────────────────┴─────────┘
              ]]> </artwork> </artset>
        </figure>

        <t>In step (5), host B4 sends a response back to host A5. I reverses source and destination addresses and sends a
          packet to gateway GWB. In step (6), the packet arrives at gateway GWB. The gateway recognizes the destination address
          as an <em>encoded</em> address previously created to represent IPREF address 198.51.100.11+50. It places this IPREF
          address in the packet as the new destination address. The gateway also recognizes the source address as corresponding
          to a preset IPREF address 198.51.100.22+400. It places this IPREF address as the new source address. It then sends
          the packet to the <em>third</em> network. In step (7), the packet arrives at gateway GWA. The gateway recognizes the
          destination IPREF address as corresponding to the local host A5 172.17.1.75. It places this address in the packet
          as the new destination address. It also recognizes the source IPREF address as one represented by an <em>encoded</em>
          address 10.128.0.40. It places that address in the packet as the new source address. It then sends the packet to the
          local host A5. in step (8), local host A5 recognizes the destination address 172.17.1.75 as its own and consumes
          the packet for processing. This concludes packet exchange.
        </t>
        <t>In general case, networks may have overlapping addresses, they may have several local subnets, they may have more
          than one gateway to the <em>third</em> network. They may also run different network protocols. For example
          one private network may run IPv4 while its peer may run IPv6. The communicating networks do not need to know their
          peers' actual IP addresses or network protocols. The references are the stand ins representing those addresses in
          their native network protocol domains. The references are interpreted independently by both communicating networks.
          In the example above, network B allocates reference '400' to represent host B4. At network B, that reference is
          interpreted as 172.18.2.64 whereas that same reference is interpreted as 10.128.0.4 at network A. Neither network
          knows, or cares about, how the references are interpreted outside of their own administrative domains. In cases
          where interpretation involves changing network protocol, the local gateway must run dual stacks and perform proper
          repackaging of the packets. Of course, higher level protocol, such as TCP/UDP, must be compatible for this to be
          practical. IPv4 and IPv6 meet this criterion.
        </t>

      </section>  <!-- ^^ Packet Exchange ^^ -->

      <section><name>DNS with IPREF</name>
        <t>text dns with ipref</t>
      </section>  <!-- ^^ DNS with IPREF ^^ -->

    </section>  <!-- ^^Overview^^ -->

    <section><name>IPREF Reference</name>
      <t>text ipref reference</t>
    </section>

    <section><name>IPREF Address</name>
      <t>text ipref address</t>
    </section>

    <section><name>Embedding References in IP Packets </name>

      <t>A reference is a network layer entity and the most natural place for embedding it would
         be a network layer header, such as an IPv4 option or an IPv6 next header. Another way of
         embedding a reference is to place it along with the payload. One such common
         technique is tunneling where a reference could be placed along with a network packet
         being tunneled.
      </t>
      <t>In terms of how the reference is processed, the most natural place for embedding it would
         be with the payload, not with the header. The reason is because while the packets traverse
         the <em>third</em> network, the reference remains opaque. It is processed only at the IPREF
         gateways of the communicating private networks.
      </t>

      <section><name>IPv4 Option</name>
        <t>text ipv4 option</t>
      </section>

      <section><name>IPv6 Next Header</name>
        <t>text ipv6 next header</t>
      </section>

      <section><name>UDP Tunnel</name>
        <t>text udp tunnel</t>
      </section>

    </section>  <!-- ^^Embedding References^^ -->

    <section><name>Distributing IPREF Addresses</name>

      <t>text distributing IPREF addresses</t>

      <section><name>DNS Records</name>
        <t>text dns records</t>
      </section>

      <section><name>Local Network Resolver</name>
        <t>text local network resolver</t>
      </section>

      <section><name>DNS Agent</name>
        <t>text dns agent</t>
      </section>

    </section>  <!-- ^^Distributing IPREF Addresses^^ -->

    <section><name>Related Technologies</name>
      <t>text related technologies</t>
    </section>

    <section><name>Distinct Properties</name>
      <t>text distinct properties</t>
    </section>

    <section anchor="IANA">
    <!-- All drafts are required to have an IANA considerations section. See RFC 8126 for a guide.-->
      <name>IANA Considerations</name>
      <t>This memo includes no request to IANA.</t>
    </section>

    <section anchor="Security">
      <!-- All drafts are required to have a security considerations section. See RFC 3552 for a guide. -->
      <name>Security Considerations</name>
      <t>This document should not affect the security of the Internet.</t>
    </section>

    <!-- NOTE: The Acknowledgements and Contributors sections are at the end of this template -->
  </middle>

  <back>
    <references>
      <name>References</name>
      <references>
        <name>Normative References</name>

        <xi:include href="https://www.rfc-editor.org/refs/bibxml/reference.RFC.8174.xml"/>
        <!-- The recommended and simplest way to include a well known reference -->

      </references>

      <references>
        <name>Informative References</name>

        <reference anchor="RFC2119" target="https://www.rfc-editor.org/info/rfc2119">
        <!-- Manually added reference -->
          <front>
            <title>Key words for use in RFCs to Indicate Requirement Levels</title>
            <author initials="S." surname="Bradner" fullname="S. Bradner">
              <organization/>
            </author>
            <date year="1997" month="March"/>
            <abstract>
              <t>In many standards track documents several words are used to signify the requirements in the specification. These words are often capitalized. This document defines these words as they should be interpreted in IETF documents. This document specifies an Internet Best Current Practices for the Internet Community, and requests discussion and suggestions for improvements.
              </t>
            </abstract>
          </front>
          <seriesInfo name="BCP" value="14"/>
          <seriesInfo name="RFC" value="2119"/>
          <seriesInfo name="DOI" value="10.17487/RFC2119"/>
        </reference>

        <reference anchor="exampleRefMin">
        <!-- Example minimum reference -->
          <front>
            <title>Title</title>
            <author initials="Initials" surname="Surname">
              <organization/>
            </author>
            <date year="2006"/>
          </front>
        </reference>

        <reference anchor="exampleRefOrg" target="http://www.example.com/">
        <!-- Example reference written by an organization not a person -->
          <front>
            <title>Title</title>
            <author>
              <organization>Organization</organization>
            </author>
            <date year="1984"/>
          </front>
        </reference>

      </references>
    </references>

    <section>
      <name>Appendix 1</name>
      <t>This becomes an Appendix</t>
    </section>

    <section anchor="Acknowledgements" numbered="false">
      <!-- an Acknowledgements section is optional -->
      <name>Acknowledgements</name>
      <t>This template uses extracts from templates written by Pekka Savola, Elwyn Davies and
        Henrik Levkowetz.</t>
    </section>

    <section anchor="Contributors" numbered="false">
      <!-- a Contributors section is optional -->
      <name>Contributors</name>
      <t>Thanks to all of the contributors.</t>
      <contact fullname="Jane Doe" initials="J" surname="Doe"><!-- https://authors.ietf.org/en/rfcxml-vocabulary#contact-->
        <!-- including contact information for contributors is optional -->
        <organization>Acme</organization>
        <address>
          <email>jdoe@example.com</email>
        </address>
      </contact>
    </section>

 </back>
</rfc>
<!-- vim: tabstop=2 softtabstop=2 shiftwidth=2 expandtab
-->
